<div class="edit-cra">
  <div class="edit-cra__header">
      <div class="edit-cra__header__container">
          <a href="./" title="Retour à l'accueil">
              <img class="edit-cra__header__container__logo" src="assets/images/logo.white.svg" alt="logo acrabadabra" onerror="this.removeAttribute('onerror'); this.src='//assets/images/logo.white.png'">
          </a>
      </div>
  </div>

  <div class="edit-cra__wrapper">
      <div class="edit-cra__wrapper__title">
          <h2>{{ title[mode] }} un compte rendu d'activité</h2>
      </div>

      <div class="edit-cra__wrapper__modals">
          <div
          class="edit-cra__wrapper__modals__modal modal show"
          tabindex="-1"
          role="dialog"
          aria-label="Close"
          [toggled]="showModal"
          (close)="onModalClose('showModal')"
          >
              <div class="edit-cra__wrapper__modals__modal__dialog modal-dialog" role="document">
                  <div class="edit-cra__wrapper__modals__modal__dialog__content modal-content">
                      <div class="edit-cra__wrapper__modals__modal__dialog__content__header modal-header">
                          <h5 class="modal-title">Votre CRA a bien été créé</h5>
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true" aria-label="Close">&times;</span>
                          </button>
                      </div>
                      <div class="edit-cra__wrapper__modals__modal__dialog__content__body modal-body">
                          <p>
                            Conservez
                            <a target="_blank" [routerLink]="['/cra/edit']" [queryParams]="{ data: editToken }">ce lien</a>
                            pour le modifier ultérieurement.
                          </p>
                          <p>
                            Envoyez
                            <a target="_blank" [routerLink]="['/cra/edit']" [queryParams]="{ data: reviewToken }">ce lien</a>
                            pour le partager en lecture seule.
                          </p>
                          <p *ngIf="generateInvoice">
                            Utiliser
                            <a target="_blank" [href]="billLink">ce lien</a>
                            pour obtenir votre facture.
                          </p>
                          <u>
                            Si vous modifiez le CRA, vous devrez le valider à nouveau et utiliser le nouveau lien de partage.
                          </u>
                      </div>
                      <div class="edit-cra__wrapper__modals__modal__dialog__content__footer modal-footer">
                          <button data-text="Fermer" type="button" class="edit-cra__wrapper__modals__modal__dialog__content__footer__button" data-dismiss="modal" aria-label="Close">
                              Fermer
                          </button>
                      </div>
                  </div>
              </div>
          </div>

          <div
          class="edit-cra__wrapper__modals__modal modal show"
          tabindex="-1"
          role="dialog"
          aria-label="Close"
          [toggled]="showErrorModal"
          (close)="onModalClose('showErrorModal')"
          >
              <div class="edit-cra__wrapper__modals__modal__dialog modal-dialog" role="document">
                  <div class="edit-cra__wrapper__modals__modal__dialog__content modal-content">
                      <div class="edit-cra__wrapper__modals__modal__dialog__content__header modal-header">
                          <h5 class="modal-title">Validation impossible</h5>
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                              <span aria-hidden="true" aria-label="Close">&times;</span>
                          </button>
                      </div>
                      <div class="edit-cra__wrapper__modals__modal__dialog__content__body modal-body">
                          <p class="">
                              Veuillez vérifier votre saisie.
                          </p>
                      </div>
                      <div data-text="Fermer" class="edit-cra__wrapper__modals__modal__dialog__content__footer modal-footer">
                          <button type="button" class="edit-cra__wrapper__modals__modal__dialog__content__footer__button" data-dismiss="modal" aria-label="Close">
                              Fermer
                          </button>
                      </div>
                  </div>
              </div>
          </div>
      </div>

      <form class="edit-cra__wrapper__form" [formGroup]="form">
          <div id="prestataire" class="edit-cra__wrapper__form__block">
              <h4 class="edit-cra__wrapper__form__block__title">Consultant</h4>
              <div class="edit-cra__wrapper__form__block__input-wrapper">
                  <div class="edit-cra__wrapper__form__block__input-wrapper__item form-group">
                      <label for="consultantNameInput" class="edit-cra__wrapper__form__block__input-wrapper__item__label">Nom</label>
                      <div class="edit-cra__wrapper__form__block__input-wrapper__item__input">
                          <input
                          type="text"
                          class="form-control"
                          name="consultantNameInput"
                          formControlName="consultantNameInput"
                          >
                          <div
                          *ngIf="consultantNameInput.invalid && (consultantNameInput.dirty || consultantNameInput.touched)"
                          class="alert alert-danger"
                          >
                              <div *ngIf="consultantNameInput.errors['required']">
                                  Ce champ est obligatoire
                              </div>
                          </div>
                      </div>
                  </div>
                  <div class="edit-cra__wrapper__form__block__input-wrapper__item form-group">
                      <label for="consultantEmailInput" class="edit-cra__wrapper__form__block__input-wrapper__item__label">Email</label>
                      <div class="edit-cra__wrapper__form__block__input-wrapper__item__input">
                          <input
                          type="email"
                          class="form-control"
                          name="consultantEmailInput"
                          formControlName="consultantEmailInput"
                          >
                          <div
                          *ngIf="consultantEmailInput.invalid && (consultantEmailInput.dirty || consultantEmailInput.touched)"
                          class="alert alert-danger"
                          >
                              <div *ngIf="consultantEmailInput.errors['required']">
                                  Ce champ est obligatoire
                              </div>
                              <div *ngIf="consultantEmailInput.errors['email']">
                                  Adresse mail non valide
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          </div>

          <div id="mission" class="edit-cra__wrapper__form__block">
              <h4 class="edit-cra__wrapper__form__block__title">Mission</h4>
              <div class="edit-cra__wrapper__form__block__input-wrapper">
                  <div class="edit-cra__wrapper__form__block__input-wrapper__item form-group">
                      <label for="missionTitleInput" class="edit-cra__wrapper__form__block__input-wrapper__item__label">Intitulé</label>
                      <div class="edit-cra__wrapper__form__block__input-wrapper__item__input">
                          <input
                          type="text"
                          class="form-control"
                          name="missionTitleInput"
                          formControlName="missionTitleInput"
                          >
                          <div
                          *ngIf="missionTitleInput.invalid && (missionTitleInput.dirty || missionTitleInput.touched)"
                          class="alert alert-danger"
                          >
                              <div *ngIf="missionTitleInput.errors['required']">
                                  Ce champ est obligatoire
                              </div>
                          </div>
                      </div>
                  </div>

                  <div class="edit-cra__wrapper__form__block__input-wrapper__item form-group">
                      <label for="missionFinalClient" class="edit-cra__wrapper__form__block__input-wrapper__item__label">Client final</label>
                      <div class="edit-cra__wrapper__form__block__input-wrapper__item__input">
                          <input
                          type="text"
                          class="form-control"
                          name="missionFinalClientInput"
                          formControlName="missionFinalClientInput"
                          autocomplete="companyName"
                          >
                          <div
                          *ngIf="missionFinalClientInput.invalid && (missionFinalClientInput.dirty || missionFinalClientInput.touched)"
                          class="alert alert-danger"
                          >
                              <div *ngIf="missionFinalClientInput.errors['required']">
                                  Ce champ est obligatoire
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          </div>

          <div class="edit-cra__wrapper__form__component">
              <h4 class="edit-cra__wrapper__form__component__title">Compte rendu d'activité</h4>
              <app-calendar
              [minifiedTimesheet]="cra.timesheet"
              [picking]="mode !== 'review'"
              >
              </app-calendar>
          </div>

          <div class="edit-cra__wrapper__form__component">
              <label class="edit-cra__wrapper__form__component__toggle">
                <input name="billToggle" type="checkbox" [(ngModel)]="generateInvoice" [ngModelOptions]="{standalone: true}">
                Générer une facture
              </label>
              <app-billing-form *ngIf="generateInvoice"></app-billing-form>
          </div>

          <div class="edit-cra__wrapper__form__submit">
            <button
            data-text="Valider mon CRA"
            *ngIf="mode !== 'review'"
            class="edit-cra__wrapper__form__submit__button"
            (click)="onSubmitCRA()"
            >
              <span>Valider mon CRA</span>
            </button>
          </div>
      </form>
  </div>
</div>
