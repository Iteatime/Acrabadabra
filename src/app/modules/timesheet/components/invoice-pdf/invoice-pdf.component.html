<div class="invoice">
  <div class="invoice__header">
    <div class="invoice__header__provider">
      <div class="invoice__header__provider__name">
        {{ timesheetService.timesheet.invoice.provider.name }}
      </div>
      <div [innerHTML]="timesheetService.timesheet.invoice.provider.getFormattedAddress()"></div>
      <div *ngIf="timesheetService.timesheet.invoice.provider.telephone">
        Tel : {{ timesheetService.timesheet.invoice.provider.getFormattedTelephoneNumber() }}
      </div>
      <div *ngIf="!timesheetService.timesheet.invoice.provider.tradeAndCompaniesRegisterExemption">
        {{ timesheetService.timesheet.invoice.provider.getFormattedSIRENNumber() }} R.C.S.
        {{ timesheetService.timesheet.invoice.provider.tradeAndCompaniesRegisterCity }}
      </div>
      <div *ngIf="timesheetService.timesheet.invoice.provider.tradeAndCompaniesRegisterExemption">
        SIREN : {{ timesheetService.timesheet.invoice.provider.getFormattedSIRENNumber() }}
      </div>
      <div *ngIf="!timesheetService.timesheet.invoice.provider.vatExemption">
        N° TVA intra-communautaire : {{ timesheetService.timesheet.invoice.provider.vatNumber }}
      </div>
      <div *ngIf="timesheetService.timesheet.invoice.provider.tradeAndCompaniesRegisterExemption">
        Dispensé d'immatriculation au registre du commerce et des sociétés (RCS) et au répertoire des métiers (RM)
      </div>
    </div>
    <div class="invoice__header__client">
      <div class="invoice__header__client__name">
        {{ timesheetService.timesheet.invoice.client.name }}
      </div>
      <div [innerHTML]="timesheetService.timesheet.invoice.client.getFormattedAddress()"></div>
      <div *ngIf="timesheetService.timesheet.invoice.client.telephone">
        Tel : {{ timesheetService.timesheet.invoice.client.getFormattedTelephoneNumber() }}
      </div>
      <div *ngIf="!timesheetService.timesheet.invoice.client.tradeAndCompaniesRegisterExemption">
        {{ timesheetService.timesheet.invoice.client.getFormattedSIRENNumber() }} R.C.S.
        {{ timesheetService.timesheet.invoice.client.tradeAndCompaniesRegisterCity }}
      </div>
      <div *ngIf="timesheetService.timesheet.invoice.client.tradeAndCompaniesRegisterExemption">
        SIREN : {{ timesheetService.timesheet.invoice.client.getFormattedSIRENNumber() }}
      </div>
      <div *ngIf="!timesheetService.timesheet.invoice.client.vatExemption">
        N° TVA intra-communautaire : {{ timesheetService.timesheet.invoice.client.vatNumber }}
      </div>
      <div *ngIf="timesheetService.timesheet.invoice.client.tradeAndCompaniesRegisterExemption">
        Dispensé d'immatriculation au registre du commerce et des sociétés (RCS) et au répertoire des métiers (RM)
      </div>
    </div>
  </div>

  <div class="invoice__reference">
    <div class="invoice__reference__number">FACTURE N° {{ timesheetService.timesheet.invoice.number }}</div>
    <div class="invoice__reference__order" *ngIf="timesheetService.timesheet.invoice.clientRef">
      <b>Référence client :</b> {{ timesheetService.timesheet.invoice.clientRef }}
    </div>
    <div class="invoice__reference__date">Date : {{ formatDate(timesheetService.timesheet.invoice.date) }}</div>
  </div>

  <div class="invoice__table">
    <table>
      <thead>
        <th>DESIGNATION DES PRODUITS OU PRESTATIONS</th>
        <th>PRIX UNITAIRE HT</th>
        <th>QUANTITE</th>
        <th *ngIf="!timesheetService.timesheet.invoice.provider.vatExemption">TAUX DE TVA</th>
        <th *ngIf="!timesheetService.timesheet.invoice.provider.vatExemption">TOTAL HT</th>
        <th *ngIf="timesheetService.timesheet.invoice.provider.vatExemption">TOTAL TTC</th>
      </thead>
      <tbody>
        <tr *ngIf="workedTime > 0">
          <td>Journée d’intervention {{ timesheetService.timesheet.mission.title }}</td>
          <td>{{ timesheetService.timesheet.invoice.dailyRate | currency:currencyCode:"symbol":"1.2-2":local }}</td>
          <td>{{ workedTime }}</td>
          <td *ngIf="!timesheetService.timesheet.invoice.provider.vatExemption">{{ vatRate / 100 | percent:"1.2-2":local }}</td>
          <td>{{ performanceTotal | currency:currencyCode:"symbol":"1.2-2":local }}</td>
        </tr>
        <tr *ngIf="expenseTotal > 0">
          <td>{{expenseTitle}}</td>
          <td></td>
          <td>{{expenseQuantity}}</td>
          <td *ngIf="!timesheetService.timesheet.invoice.provider.vatExemption">{{ 0 | percent:"1.2-2":local  }}</td>
          <td>{{expenseTotal | currency:currencyCode:"symbol":'1.2-2':local}}</td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td></td>
          <td *ngIf="!timesheetService.timesheet.invoice.provider.vatExemption"></td>
          <td></td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td></td>
          <td *ngIf="!timesheetService.timesheet.invoice.provider.vatExemption"></td>
          <td></td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="invoice__total">
    <table>
      <tr *ngIf="!timesheetService.timesheet.invoice.provider.vatExemption  && totalVat > 0">
        <td class="invoice__total__label">
          Total HT
          <br />
          <span *ngIf="totalTTC">
            Montant TVA {{ vatRate }}%
          </span>
        </td>
        <td></td>
        <td class="invoice__total__value">
          <p>{{ totalHT | currency:currencyCode:"symbol":'1.2-2':local }}</p>
          <span *ngIf="totalTTC">
            {{ totalVat | currency:currencyCode:"symbol":'1.2-2':local }}
          </span>
        </td>
      </tr>
      <tr *ngIf="!timesheetService.timesheet.invoice.provider.vatExemption  && totalVat > 0"></tr>
      <tr>
        <td class="invoice__total__label">Total TTC</td>
        <td></td>
        <td class="invoice__total__value">{{ totalTTC | currency:currencyCode:"symbol":'1.2-2':local }}</td>
      </tr>
      <tr *ngIf="timesheetService.timesheet.invoice.provider.vatExemption">
        <td class="invoice__total__no-vat" colspan="3">
          TVA non applicable, art 293 B du CGI
        </td>
      </tr>
    </table>
  </div>

  <div class="invoice__additional-information">
    <div>
      Consultant chargé de la prestation : {{ timesheetService.timesheet.consultant.name }}
    </div>
    <div>
      Date d’exécution de la vente
      <br />
      ou de la prestation : {{ formatDuration() }}
    </div>
    <div>
      Date de règlement : {{ formatDate(timesheetService.timesheet.invoice.paymentDate) }}
    </div>
    <div *ngIf="timesheetService.timesheet.invoice.paymentLatePenalty" id="penalty">
      Tout retard de paiement donnera lieu, en plus des pénalités de retard (10 % par an), au versement d'une indemnité
      forfaitaire de 40€ pour frais de recouvrement.
    </div>
    <div *ngIf="timesheetService.timesheet.invoice.paymentModality">
      Modalités de paiement : {{ timesheetService.timesheet.invoice.paymentModality }}
    </div>
    <div *ngIf="timesheetService.timesheet.invoice.isBankingDetails()">
      <div>Coordonnées bancaires :</div>
      <div>Titulaire du compte : {{ timesheetService.timesheet.invoice.bankAccountHolder }}</div>
      <div>Banque : {{ timesheetService.timesheet.invoice.bankingDomiciliation }}</div>
      <div>Agence : {{ timesheetService.timesheet.invoice.bankingAgency }}</div>
      <div>IBAN : {{ timesheetService.timesheet.invoice.bankIBAN }}</div>
      <div>SWIFT : {{ timesheetService.timesheet.invoice.bankSWIFT }}</div>
    </div>
  </div>

  <div class="invoice__footer">
    <div>
      {{ timesheetService.timesheet.invoice.provider.name }}
      -
      {{ timesheetService.timesheet.invoice.provider.address.replace(';', '') }}
      -
      <span *ngIf="timesheetService.timesheet.invoice.provider.telephone">Tel :{{ timesheetService.timesheet.invoice.provider.getFormattedTelephoneNumber() }} - </span>
      <span *ngIf="!timesheetService.timesheet.invoice.provider.tradeAndCompaniesRegisterExemption">R.C.S.
        {{ timesheetService.timesheet.invoice.provider.tradeAndCompaniesRegisterCity }} </span>
      <span *ngIf="timesheetService.timesheet.invoice.provider.tradeAndCompaniesRegisterExemption">SIREN : </span>
      {{ timesheetService.timesheet.invoice.provider.getFormattedSIRENNumber() }}
    </div>
  </div>

  <div class="invoice__expense-mileage" *ngIf="timesheetService.timesheet.commutes.length > 0">
    <p>Détail des indemnités kilométriques :</p>
    <app-expense-mileage-table [hideDeleteButton]="true">
    </app-expense-mileage-table>
  </div>
</div>
